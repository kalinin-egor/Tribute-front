# Tribute Frontend Architecture

## Обзор

Приложение построено по принципам чистой архитектуры с разделением на слои:

- **Domain** - бизнес-логика и типы
- **Data** - работа с API и внешними источниками данных
- **Presentation** - UI компоненты и хуки

## Структура проекта

```
src/
├── Domain/
│   └── types.ts          # Все типы данных
├── Data/
│   └── api.ts           # API сервис
├── Presentation/
│   ├── Components/      # Переиспользуемые компоненты
│   ├── Scenes/         # Страницы приложения
│   └── hooks/          # React хуки
└── utils/
    └── helpers.ts      # Утилиты
```

## API Интеграция

### Аутентификация
Приложение использует Telegram Web App `initData` для аутентификации. Токен автоматически добавляется в заголовок `Authorization` в формате `TgAuth <initData>`.

### Основные эндпоинты

1. **GET /dashboard** - получение данных дашборда
2. **PUT /onboard** - регистрация пользователя
3. **POST /add-bot** - добавление бота/канала
4. **POST /publish-subscription** - публикация подписки
5. **POST /create-subscribe** - создание подписки
6. **POST /set-up-payouts** - настройка выплат
7. **POST /upload-verified-passport** - загрузка документов для верификации

## Навигация

### Логика навигации

1. При загрузке приложения автоматически вызывается `/dashboard`
2. Если пользователь не зарегистрирован (404), происходит редирект на `/monetization`
3. После успешного онбординга происходит редирект на `/dashboard`
4. Если пользователь уже зарегистрирован, сразу открывается `/dashboard`

### Состояние приложения

Управляется через хук `useAppState`:

```typescript
interface AppState {
  isLoading: boolean;
  isOnboarded: boolean;
  dashboardData: DashboardResponse | null;
  error: string | null;
}
```

## Компоненты

### Основные компоненты

- **EarningsSummary** - отображение заработка и статуса верификации
- **QuickActions** - быстрые действия и статус каналов
- **TransactionsPlaceholder** - история транзакций и подписок
- **PayoutAlert** - уведомление о необходимости настройки выплат
- **GettingStarted** - руководство для новых пользователей

### Пропсы компонентов

Все компоненты принимают данные через пропсы, что обеспечивает:
- Переиспользуемость
- Тестируемость
- Предсказуемость

## Хуки

### useTelegram
Предоставляет доступ к Telegram Web App API и пользовательским данным.

### useAppState
Управляет глобальным состоянием приложения и навигацией.

### useApi
Предоставляет удобный доступ ко всем методам API.

## Типы данных

Все типы определены в `Domain/types.ts` и соответствуют API документации:

- `DashboardResponse` - ответ от /dashboard
- `ChannelDTO` - информация о канале
- `SubDTO` - информация о подписке
- `PaymentDTO` - информация о платеже
- И другие...

## Обработка ошибок

1. **Сетевые ошибки** - отображаются пользователю с возможностью повтора
2. **Ошибки аутентификации** - редирект на страницу онбординга
3. **Ошибки валидации** - отображаются в соответствующих формах

## Стилизация

Используется Tailwind CSS с модульными стилями для компонентов. Все стили находятся в соответствующих `.module.css` файлах.

## Разработка

### Добавление нового эндпоинта

1. Добавить тип в `Domain/types.ts`
2. Добавить метод в `Data/api.ts`
3. Добавить метод в `Presentation/hooks/useApi.tsx`
4. Использовать в компонентах

### Добавление нового компонента

1. Создать компонент в `Presentation/Components/`
2. Определить интерфейс пропсов
3. Добавить стили в `.module.css`
4. Интегрировать в соответствующие страницы

## Тестирование

Архитектура позволяет легко тестировать:
- Бизнес-логику в Domain слое
- API вызовы в Data слое
- UI компоненты в Presentation слое

## Производительность

- Ленивая загрузка компонентов
- Мемоизация хуков с useCallback
- Оптимизированные ре-рендеры
- Кэширование API ответов 